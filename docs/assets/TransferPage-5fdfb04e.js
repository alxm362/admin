import{T as p,H as h}from"./helpers-e3b30bc1.js";import{N as M,B as z,g as S,O as E,e as W,f as I,h as q,R as D,a as C,b as e,u as s,c as T,w as P,i as x,F as B,j as J,o as d,l as H,m as K,t as v,v as A,p as R}from"./index-3efd29d9.js";import{_ as Q,a as X,b as Y}from"./EmptyResourceComponent-c4bb86e1.js";import{_ as Z}from"./MyDropdownComponent-1207980f.js";const ee=M("transfer",()=>{const m=z(),u="transfer",i=S([]),b=S(!1);function f(a){i.value=a}function k(a){b.value=a}function _(a,c){const l=i.value;if(!l)return;const g=l.findIndex(t=>t._id===a);l[g]=c,f(l)}async function N(){k(!1);try{const a=await E.get(`master/${u}`);f(a.data.data.transfers)}catch(a){console.error(a),m.handlePost(a.response)}k(!0)}async function y(a,c){try{m.setPost(!0);const l=await E.patch(`master/${u}/update-status/${a}`,{status:c});_(a,l.data.data.transfer),m.handlePost(l)}catch(l){console.error(l),m.handlePost(l.response)}}async function r(a){try{m.setPost(!0);const c=await E.delete(`master/${u}/delete/${a}`),l=i.value;if(!l)return;const g=l.filter(t=>t._id!==a);f(g),m.handlePost(c)}catch(c){console.error(c),m.handlePost(c.response)}}return{loaded:b,transfers:i,fetchAll:N,updateStatus:y,deleteOne:r}}),te={class:"row mt-4"},se={class:"col-12"},ae={class:"card"},ne={key:1,class:"card-body pt-0 px-0"},oe={class:"d-none"},re=["onClick"],le=["onClick"],ie=["onClick"],ue={class:"text-center"},fe=W({__name:"TransferPage",setup(m){const u=S(!1),i=S(),b=t=>i.value=t,f=S(),k=t=>f.value=t,_=ee(),N=I(()=>_.transfers),y=I(()=>_.loaded);y.value||_.fetchAll();const r=q({status:D.INFO,title:"",message:"",onConfirm:()=>{}}),a=(t,n)=>{var w;b(t),k(n),n===p.SUCCESSFUL?(r.status=D.INFO,r.title="Do you really wants to approve this transfer?",r.message=`Approving this transfer will credit ${h.toTitleCase(((w=t.toUser)==null?void 0:w.username)||"Unknown")} with the sum of ${h.toCurrency(t.amount)} and cannot be reversed.`):(r.status=D.WARNING,r.title="Do you really wants to cancel this transfer?",r.message=`Canceling this transfer mark it has ${n} and reversed the money back to the sender account`),r.onConfirm=l,u.value=!0},c=t=>{i.value=t,r.status=D.DANGER,r.title="Do you really wants to delete this transfer?",r.message="Deleting this transfer can not be reversed",r.onConfirm=g,u.value=!0},l=()=>{i.value&&(f.value!==p.REVERSED&&f.value!==p.SUCCESSFUL||(u.value=!1,_.updateStatus(i.value._id,f.value)))},g=()=>{i.value&&(u.value=!1,_.deleteOne(i.value._id))};return(t,n)=>{var U;const w=Q,G=Y,L=Z,O=X,V=J;return d(),C(B,null,[e("div",te,[e("div",se,[e("div",ae,[n[6]||(n[6]=e("div",{class:"card-header"},[e("h4",{class:"card-title"},"Users Transfers")],-1)),s(y)&&!((U=s(N))!=null&&U.length)?(d(),T(w,{key:0},{default:P(()=>n[1]||(n[1]=[H(" No Transfer Record Found ")])),_:1})):(d(),C("div",ne,[s(y)?(d(),T(O,{key:1,ordering:"",searching:""},{default:P(()=>[n[5]||(n[5]=e("thead",{class:"bg-background"},[e("tr",null,[e("th",{class:"text-sharp d-none"},"Sort"),e("th",{class:"text-sharp text-center"},"Action"),e("th",{class:"text-sharp text-center"},"Status"),e("th",{class:"text-sharp"},"Amount"),e("th",{class:"text-sharp"},"Fee"),e("th",{class:"text-sharp"},"Sender"),e("th",{class:"text-sharp"},"Receiver"),e("th",{class:"text-sharp"},"Created"),e("th",{class:"text-sharp"},"Settled")])],-1)),e("tbody",null,[(d(!0),C(B,null,K(s(N),(o,j)=>{var $,F;return d(),C("tr",{key:o._id},[e("td",oe,v(j+1),1),e("td",null,[x(L,null,{default:P(()=>[o.status===s(p).PENDING?(d(),C("a",{key:0,onClick:()=>a(o,s(p).SUCCESSFUL),class:"dropdown-item border-bottom",href:"javascript:;"},n[2]||(n[2]=[e("i",{class:A("bi bi-check-circle me-2")},null,-1),H("Approve")]),8,re)):R("",!0),o.status===s(p).PENDING?(d(),C("a",{key:1,onClick:()=>a(o,s(p).REVERSED),class:"dropdown-item",href:"javascript:;"},n[3]||(n[3]=[e("i",{class:A("bi bi-slash-circle me-2")},null,-1),H("Cancel")]),8,le)):R("",!0),o.status!==s(p).PENDING?(d(),C("a",{key:2,onClick:()=>c(o),class:"dropdown-item",href:"javascript:;"},n[4]||(n[4]=[e("i",{class:"bi bi-trash me-2"},null,-1),H("Delete")]),8,ie)):R("",!0)]),_:2},1024)]),e("td",ue,[e("span",{class:A(`badge light badge-${("Helpers"in t?t.Helpers:s(h)).toStatus(o.status)}`)},v(("Helpers"in t?t.Helpers:s(h)).toTitleCase(o.status)),3)]),e("td",null,v(("Helpers"in t?t.Helpers:s(h)).toCurrency(o.amount)),1),e("td",null,v(o.fee?("Helpers"in t?t.Helpers:s(h)).toCurrency(-o.fee):"--"),1),e("td",null,v(($=o.fromUser)==null?void 0:$.username),1),e("td",null,v((F=o.toUser)==null?void 0:F.username),1),e("td",null,v(("Helpers"in t?t.Helpers:s(h)).toNiceDate(o.createdAt)),1),e("td",null,v(o.status===s(p).PENDING?"--":("Helpers"in t?t.Helpers:s(h)).toNiceDate(o.updatedAt)),1)])}),128))])]),_:1})):(d(),T(G,{key:0,rows:8,cols:6,searching:""}))]))])])]),x(V,{"is-open":s(u),status:s(r).status,title:s(r).title,message:s(r).message,onConfirm:s(r).onConfirm,onClose:n[0]||(n[0]=o=>u.value=!1)},null,8,["is-open","status","title","message","onConfirm"])],64)}}});export{fe as default};
